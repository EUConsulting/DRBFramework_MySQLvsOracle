# DRB Framework Convert MySQL vs Oracle 23ai
Documentazione Tecnica - Versione 2.0

## Panoramica
Il framework automatizza la conversione di database MySQL in Oracle 23ai utilizzando SQLines. Il processo preserva lo storico delle migrazioni e gestisce automaticamente le limitazioni di SQLines.

## Componenti Principali

### 1. PipelineMySQLtoOracleConversion.ps1
Script principale che orchestra l'intero processo di conversione.

**Funzionalita:**
- Selezione interattiva della cartella contenente i dump MySQL
- Download e configurazione automatica di SQLines
- Gestione multi-database con selezione singola per evitare limitazioni
- Creazione automatica delle directory di lavoro
- Archiviazione automatica delle conversioni precedenti
- Rinomina dei file di output con il nome del database

**Parametri:**
- DumpFolder: Cartella contenente i file SQL (opzionale, altrimenti GUI)
- SQLlinesUrl: URL per download SQLines (default: versione 3.3.177)
- SkipDownload: Salta il download di SQLines se gia presente
- SkipCleanup: Salta la pulizia dell'ambiente

**Workflow:**
1. Pulizia ambiente precedente tramite clear_ambiente.ps1
2. Selezione database da convertire
3. Download/estrazione SQLines
4. Creazione cartelle bck, inputOracle, outputOracle
5. Esecuzione clear_dump_mysql.ps1 per ogni file
6. Conversione tramite SQLines
7. Rinomina output con nome database
8. Apertura report finale

### 2. clear_dump_mysql.ps1
Prepara i dump MySQL per la conversione rimuovendo elementi non compatibili.

**Funzionalita:**
- Rimuove DEFINER statements
- Elimina ENGINE e CHARSET specifications
- Converte tipi di dato (DATETIME->TIMESTAMP, LONGTEXT->CLOB, etc.)
- Rimuove COLLATE clauses
- Sostituisce variabili @ con variabili semplici
- Rimuove deallocate prepare statements
- Mantiene AUTO_INCREMENT per conversione SQLines

**Input/Output:**
- Input: file SQL originale
- Output: inputoracle/nomefile_mysql.sql
- Backup: bck/nomefile_backup.sql

### 3. clear_ambiente.ps1
Gestisce l'archiviazione delle conversioni precedenti.

**Funzionalita:**
- Crea cartella StoricoMigrazioni
- Archivia cartelle out_*, scripts_* con timestamp
- Archivia report e log SQLines
- Copia i 3 script PS1 per tracciabilita
- Exit commentata per disabilitazione rapida

**Struttura archivio:**
StoricoMigrazioni/
  NOMEDATABASE_YYYYMMDD_HHMMSS/
    - out_NOMEDATABASE/
    - scripts_NOMEDATABASE/
    - sqlines_report_NOMEDATABASE.html
    - sqlines_NOMEDATABASE.log
    - clear_dump_mysql.ps1
    - PipelineMySQLtoOracleConversion.ps1
    - clear_ambiente.ps1

## Directory di Lavoro

**Input:**
- *.sql: dump MySQL originali

**Output:**
- bck/: backup file originali
- inputOracle/: file puliti per SQLines
- outputOracle/: file convertiti Oracle
- SQLlines/: eseguibile SQLines
- StoricoMigrazioni/: archivio conversioni

**File SQLines:**
- out_NOMEDATABASE/: snippet conversione
- scripts_NOMEDATABASE/: script Oracle generati
- sqlines_report_NOMEDATABASE.html: report dettagliato
- sqlines_NOMEDATABASE.log: log conversione

## Limitazioni e Soluzioni

**Limitazione SQLines Trial:**
- Massimo ~40 oggetti per conversione
- Soluzione: processare un database alla volta

**Gestione Multi-Database:**
- Menu selezione interattivo
- Rinomina automatica output per evitare sovrascritture

## Utilizzo

**Conversione Standard:**
```powershell
.\PipelineMySQLtoOracleConversion.ps1
```

**Con parametri:**
```powershell
.\PipelineMySQLtoOracleConversion.ps1 -DumpFolder "C:\MySQL\dumps" -SkipDownload
```

**Disabilitare pulizia:**
Editare clear_ambiente.ps1 e decommentare la riga exit all'inizio.

## Versionamento Script

Gli script mantengono sempre il nome originale per compatibilita.
Le versioni modificate vengono salvate con suffisso _vNN:
- clear_dump_mysql.ps1 (corrente)
- clear_dump_mysql_v01.ps1 (precedente)
- clear_dump_mysql_v02.ps1 (attuale)

## Note Tecniche

- Encoding: UTF-8 senza BOM
- Compatibilita: PowerShell 5.1+
- SQLines: versione 3.3.177
- Target: Oracle 23ai

## Troubleshooting

**Database non completamente convertito:**
- Verificare limite 40 oggetti SQLines
- Dividere il database in parti piu piccole

**Errori di conversione:**
- Controllare sqlines_NOMEDATABASE.log
- Verificare il report HTML per dettagli

**Script non trovati:**
- Assicurarsi che tutti i PS1 siano nella stessa directory
- Verificare i permessi di esecuzione PowerShell